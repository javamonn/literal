{
  "Description": "ECS Service for automl-highlight-detection-data",
  "Parameters": {
    "Cluster": {
      "Description": "ECS cluster the ECS Service should execute on",
      "Type": "String"
    },
    "EnvironmentName": {
      "Type": "String"
    },
    "DesiredCount": {
      "Description": "Count of tasks to run within the service",
      "Type": "Number",
      "Default": 2
    },
    "DockerImageUrl": {
      "Description": "URL of container image",
      "Type": "String"
    }
  },
  "Resources": {
    "Service": {
      "Type": "AWS::ECS::Service",
      "Properties": {
        "Cluster": { "Ref": "Cluster" },
        "Role": { "Ref": "ServiceRole" },
        "DesiredCount": { "Ref": "DesiredCount" },
        "TaskDefinition": { "Ref": "TaskDefintion" }
      }
    },
    "TaskDefinition": {
      "Type": "AWS::ECS::TaskDefinition",
      "Properties": {
        "Family": {
          "Ref": "EnvironmentName"
        },
        "ContainerDefinitions": [
          {
            "Name": {
              "Ref": "EnvironmentName"
            },
            "Essential": true,
            "Image": {
              "Ref": "DockerImageUrl"
            },
            "Memory": "1024",
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": { "Ref": "CloudWatchLogsGroup" },
                "awslogs-region": { "Ref": "AWS::Region" }
              }
            }
          }
        ]
      }
    },
    "CloudWatchLogsGroup": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": { "Ref": "AWS::StackName" },
        "RetentionInDays": 365
      }
    }
  }
}
